---
typora-root-url: ./images
---

## 3D数学基础

### 向量

向量： 向量是有长度有方向

#### 向量的运算

##### 向量的长度

![image-20221027173721930](/image-20221027173721930.png)

##### 标量与向量的乘法

<img src="/image-20221027174342545.png" alt="image-20221027174342545" style="zoom:25%;" />

<img src="/image-20221027174359823.png" alt="image-20221027174359823" style="zoom:25%;" />

##### 单位向量，标准化向量

把向量的单位统一变成范围1 内，向量的每一个值都除以 向量的长度

<img src="/image-20221027174652046.png" alt="image-20221027174652046" style="zoom:25%;" />

<img src="/image-20221027174707469.png" alt="image-20221027174707469" style="zoom:25%;" />

##### 向量的加法和减法

<img src="/image-20221027174813961.png" alt="image-20221027174813961" style="zoom:25%;" />

<img src="/image-20221027174908770.png" alt="image-20221027174908770" style="zoom:25%;" />

##### 通过向量的减法，求两点之间的距离

<img src="/image-20221027175152931.png" alt="image-20221027175152931" style="zoom:25%;" />

##### 向量的点乘

点乘得到的是一个标量

<img src="/image-20221027181310845.png" alt="image-20221027181310845" style="zoom:25%;" />

向量的点乘可以用来 求 两个 向量之间的 夹角

<img src="/image-20221027183155188.png" alt="image-20221027183155188" style="zoom:25%;" />

通过向量的点乘可以判断两个向量是否是同一方向

<img src="/image-20221027181807496.png" alt="image-20221027181807496" style="zoom:25%;" />

##### 向量的叉乘

向量的叉乘结果是另外一个向量

<img src="/image-20221027182047271.png" alt="image-20221027182047271" style="zoom:25%;" />

<img src="/image-20221027182112140.png" alt="image-20221027182112140" style="zoom:33%;" />

向量叉乘的应用

1. 可以通过 向量 a 和 向量 b 叉乘得到一个垂直与两个向量的 一个新向量

<img src="/image-20221027182243587.png" alt="image-20221027182243587" style="zoom:25%;" />

2. 对向量 a和b 的叉乘 去模 得到的值 是 向量 a 和向量 b 组成的一个平行四边学的面积

<img src="/image-20221027182453128.png" alt="image-20221027182453128" style="zoom: 25%;" />



### 矩阵

#### 举证的乘法

<img src="/image-20221028100037491.png" alt="image-20221028100037491" style="zoom:25%;" />

<img src="/image-20221028100253575.png" alt="image-20221028100253575" style="zoom:25%;" />

1. **矩阵乘法的 第一个矩阵行数决定行数 ， 第二个矩阵的列数决定列数**
2. 相乘的结果就是 第r行和第c列的值 为 第一个矩阵的第r行与第二个矩阵

#### 行向量和列向量相乘

一个是 行乘没一列 一个列乘以每一行

<img src="/image-20221028100920751.png" alt="image-20221028100920751" style="zoom:25%;" />

矩阵帮我们将物体进行 变换

### 矩阵乘法编程

#### 3x3矩阵乘法

<img src="/image-20221028101630909.png" alt="image-20221028101630909" style="zoom:33%;" />

#### 行向量要在左乘

<img src="/image-20221028110303477.png" alt="image-20221028110303477" style="zoom:25%;" />

### 矩阵和线性变换_旋转

#### 旋转

旋转矩阵计算方式， 首先我们用的是行向量与矩阵相乘，然后用两个特殊的向量 x 值为 0 的向量 和 y 为 0 的向量都向正方向旋转一定角度进行计算得到这个计算得到的值

> 求两个值需要两个等式，使用两个特殊的单位向量方便计算

<img src="/image-20221028155033354.png" alt="image-20221028155033354" style="zoom:25%;" />

下面的都是左手坐标系的值， 

3dx轴旋转

<img src="/image-20221031103402810.png" alt="image-20221031103402810" style="zoom:25%;" />

3dy轴旋转

<img src="/image-20221031103930544.png" alt="image-20221031103930544" style="zoom:25%;" />

3dz轴旋转

<img src="/image-20221101145217279.png" alt="image-20221101145217279" style="zoom:25%;" />

#### 两种坐标系

<img src="/image-20221028155310600.png" alt="image-20221028155310600" style="zoom:25%;" />

左手坐标系 中指指向自己就是各个轴上的正方向 然后握拳向上就是旋转的正方向

<img src="/image-20221031100759168.png" alt="image-20221031100759168" style="zoom:25%;" />

右手坐标系 中指指向自己是各个轴上正方向

#### 扩展

3d绕任意轴的旋转矩阵

> 但是因为一个物体的点太多 计算起来会十分复杂，不采用，替换方法使用欧拉角解决



### 矩阵和线性变换_缩放

#### 缩放

<img src="/image-20221101151047733.png" alt="image-20221101151047733" style="zoom:25%;" />

<img src="/image-20221101151157006.png" alt="image-20221101151157006" style="zoom:25%;" />

#### 投影

##### 正向投影

<img src="/image-20221101151849231.png" alt="image-20221101151849231" style="zoom:25%;" />

投影到 x y  z 轴组成的平面 上的 投影矩阵

##### 投影到任意一个平面上

<img src="/image-20221101151958927.png" alt="image-20221101151958927" style="zoom:25%;" />

这里的 n 是垂直与这个任意平面的一个单位向量



### 矩阵和线性变换_镜切

#### 镜像

3d空间中的任意平面的镜像

<img src="/image-20221101152350281.png" alt="image-20221101152350281" style="zoom:25%;" />

描述一个平面不是很好描述，但是可以用向量来描述，比如这里的 n 就是一个垂直与这个平面的单位向量 n [ x, y, z]

#### 切变

<img src="/image-20221101153508595.png" alt="image-20221101153508595" style="zoom:25%;" />



### 矩阵的行列式

<img src="/image-20221101153759034.png" alt="image-20221101153759034" style="zoom:25%;" />

只有方阵才存在行列式

<img src="/image-20221101153911335.png" alt="image-20221101153911335" style="zoom:25%;" />

2d行列式 计算平行四边形的面积

<img src="/image-20221101154225277.png" alt="image-20221101154225277" style="zoom:25%;" />

3d行列式 计算得到几何体的面积

<img src="/image-20221101154304029.png" alt="image-20221101154304029" style="zoom:25%;" />

### 矩阵的逆

<img src="/image-20221101154900953.png" alt="image-20221101154900953" style="zoom:25%;" />

.... 超出我的范围来啊 

工作中的应用 用来 进行 **撤销操作**

<img src="/image-20221101155302953.png" alt="image-20221101155302953" style="zoom:25%;" />



### 正交矩阵

<img src="/image-20221101155457325.png" alt="image-20221101155457325" style="zoom:25%;" />

<img src="/image-20221101155706624.png" alt="image-20221101155706624" style="zoom:25%;" />

**正交矩阵的特性就是。 矩阵的转置的值 等于  矩阵的逆**

> 后面很多用转置矩阵的地方，如果它是正交矩阵 那么我们就可以用矩阵的逆替换掉转置矩阵 进行计算

### 矩阵的转置 与 矩阵的逆

**矩阵的转置的计算方式**

只需要将 矩阵的 行 变成 矩阵的列 就可以了

<img src="/image-20221102104938766.png" alt="image-20221102104938766" style="zoom:33%;" />

常见的应用

**正交矩阵的逆矩阵等于矩阵的转置**

由于矩阵的逆矩阵很难计算，但是正交矩阵的逆矩阵等于正交矩阵的转置，所以直接用矩阵的转置来计算既可以了

### 齐次矩阵

4x4 矩阵

<img src="/image-20221101163242092.png" alt="image-20221101163242092" style="zoom:25%;" />

### 旋转的三种表示方式

+ 矩阵
+ 欧拉角
+ 四元数

绕y轴旋转90度

<img src="/image-20221101163651354.png" alt="image-20221101163651354" style="zoom:33%;" />

### 欧拉角

<img src="/image-20221101172210431.png" alt="image-20221101172210431" style="zoom:67%;" />

绕着三个垂直的坐标轴旋转

垂直的轴旋转， 飞机左右旋转

![image-20221101172416548](/image-20221101172416548.png)

x轴旋转。飞机头 再上下的转

![image-20221101172521448](/image-20221101172521448.png)

绕z轴转 飞机机翼 翻滚

![image-20221101172608727](/image-20221101172608727.png)

<img src="/image-20221101172642757.png" alt="image-20221101172642757" style="zoom:25%;" />

缺点：

+ 万向锁的问题



### 万向锁现象

万向锁：当我们选择 pitch 角为 正负90度的时候， 就被限制在只能绕垂直轴进行旋转， 就是 选择的顺序 x, y ,z 不管是那种顺序 都会存在两个轴重叠在一起的时候



### RotationMatrix

物体坐标系 和 惯性坐标系之间  旋转变换

<img src="/image-20221101174754050.png" alt="image-20221101174754050" style="zoom:33%;" />

从世界坐标系到物体坐标系 

<img src="/image-20221101174910736.png" alt="image-20221101174910736" style="zoom:50%;" />

世界坐标系平移 得到 惯性坐标系的原点 与 物体坐标系的原点是相同的， 惯性坐标系的坐标轴 与世界坐标系的坐标轴是平行的

惯性坐标系到 物体坐标系，原点重合 只需要旋转



#### 向量在两个坐标系之间的转换 惯性和物体

惯性 => 物体

物体旋转矩阵 * 向量  =  新向量

物体 => 惯性

物体旋转矩阵的转置 * 向量 = 新向量



惯性坐标系的向量 乘以 对应 变换矩阵 得到 向量在 变换后的坐标系中的 向量

变换后的坐标系中的向量 乘以 对应 变换矩阵的转置 得到 向量在 惯性坐标系中的向量



### 欧拉角的使用

#### 欧拉角转换成矩阵

<img src="/image-20221102103327651.png" alt="image-20221102103327651" style="zoom:25%;" />

**从 物体坐标系 转换成 惯性坐标系**， 按照 BPH 顺序计算得到

按照顺序 将 欧拉角 转换成 三个 轴上的 矩阵， B => z轴旋转角度矩阵， p => x轴旋转角度矩阵  h => y轴旋转角度矩阵 ，然后按照顺序 将三个矩阵相乘 得到结果

<img src="/image-20221102103837843.png" alt="image-20221102103837843" style="zoom:33%;" />

**从惯性坐标系 到 物体坐标系** ，  惯性到物体的矩阵 为 物体到惯性的矩阵 的逆矩阵，然后又因为这个矩阵是正交矩阵， 矩阵的逆 等于矩阵的转置

<img src="/image-20221102104636728.png" alt="image-20221102104636728" style="zoom:33%;" />

#### 矩阵转换成欧拉角

<img src="/image-20221102105758279.png" alt="image-20221102105758279" style="zoom:25%;" />

求 P 角

<img src="/image-20221102105816906.png" alt="image-20221102105816906" style="zoom:25%;" />



求H角

<img src="/image-20221102111712220.png" alt="image-20221102111712220" style="zoom:25%;" />

求B角

<img src="/image-20221102111814011.png" alt="image-20221102111814011" style="zoom:33%;" />

##### 特殊情况 万向锁检测

求 P 角的时候 如果 P 角 无限接近 正负 90 度的时候 设置 B角 为 0 度

<img src="/image-20221102112249713.png" alt="image-20221102112249713" style="zoom:33%;" />

然后继续往下计算



### 四元数

#### 四元数的记法

<img src="/image-20221102113353399.png" alt="image-20221102113353399" style="zoom:25%;" />

#### 四元数与任意轴旋转

<img src="/image-20221102113918793.png" alt="image-20221102113918793" style="zoom:33%;" />

得到一个新的 四元数

> 得到了四元数 也可以逆推得到 旋转角 和  旋转轴

#### 四元数的模

<img src="/image-20221102133756356.png" alt="image-20221102133756356" style="zoom:33%;" />

#### 四元数的共轭

<img src="/image-20221102134149339.png" alt="image-20221102134149339" style="zoom:33%;" />

#### 四元数的叉乘

<img src="/image-20221102134211173.png" alt="image-20221102134211173" style="zoom:33%;" />

#### 四元数旋转

<img src="/image-20221102134716157.png" alt="image-20221102134716157" style="zoom:33%;" />

#### 四元数 与 矩阵的转换

四元数 =>  矩阵

![image-20221102145317929](/image-20221102145317929.png)

![image-20221102145407677](/image-20221102145407677.png)

矩阵 => 四元数

![image-20221102150206564](/image-20221102150206564.png)

<img src="/image-20221102150229596.png" alt="image-20221102150229596" style="zoom:33%;" />

这里计算的 w x, y, z 得到的值一直是正数

<img src="/image-20221102150444493.png" alt="image-20221102150444493" style="zoom:33%;" />

解决方法 现在 图1 中 随便找一个公式计算 出一个值 然后再在 图二中 找到剩余的值 对应的公式进行计算

<img src="/image-20221102150555193.png" alt="image-20221102150555193" style="zoom:33%;" />

#### 四元数 与 欧拉角 的转换

<img src="/image-20221102151009229.png" alt="image-20221102151009229" style="zoom:33%;" />

<img src="/image-20221102151256173.png" alt="image-20221102151256173" style="zoom:33%;" />

#### 四元数的插值

插值 就是 物体从 a 到 b 求， a 到 b 中间的某个时间的 值

<img src="/image-20221102152417790.png" alt="image-20221102152417790" style="zoom:33%;" />

四元数插值

<img src="/image-20221102152545494.png" alt="image-20221102152545494" style="zoom:33%;" />

但是这个用 js 代码写出来很麻烦

换一种方式进行推导

<img src="/image-20221102152722464.png" alt="image-20221102152722464" style="zoom:33%;" />

<img src="/image-20221102152831411.png" alt="image-20221102152831411" style="zoom:33%;" />

<img src="/image-20221102152938334.png" alt="image-20221102152938334" style="zoom:33%;" />

<img src="/image-20221102153102525.png" alt="image-20221102153102525" style="zoom:33%;" />

**四元数 最大的优点 就是 可以平滑的进行 插值运算**

<img src="/image-20221102153916815.png" alt="image-20221102153916815" style="zoom:50%;" />

![image-20221102154119766](/image-20221102154119766.png)



### 几何图元

#### 射线

<img src="/image-20221102154559725.png" alt="image-20221102154559725" style="zoom:50%;" />

#### 球与圆

<img src="/image-20221102154712436.png" alt="image-20221102154712436" style="zoom:33%;" />

#### AABB 轴对其矩形边界框

<img src="/image-20221102154751275.png" alt="image-20221102154751275" style="zoom:33%;" />

<img src="/image-20221102155331686.png" alt="image-20221102155331686" style="zoom:50%;" />

#### 平面

<img src="/image-20221103102034438.png" alt="image-20221103102034438" style="zoom:50%;" />

##### 求平面到原点的距离

**平面上的任意一点 点乘 平面的 法向量 得到的值 就是 平面到原点的距离**

##### 求平面的法向量

<img src="/image-20221103102317426.png" alt="image-20221103102317426" style="zoom:33%;" />

平面内两个向量的 叉乘得到 平面的法向量， 向量的叉乘得到法向量

##### 点到平面的距离

<img src="/image-20221103102629468.png" alt="image-20221103102629468" style="zoom:50%;" />

#### 三角形

##### 正弦公式

<img src="/image-20221103103336326.png" alt="image-20221103103336326" style="zoom:33%;" />

##### 余弦公式

<img src="/image-20221103103404541.png" alt="image-20221103103404541" style="zoom:33%;" />

##### 面积

<img src="/image-20221103103714315.png" alt="image-20221103103714315" style="zoom:50%;" />

#### 多边形

<img src="/image-20221103104121306.png" alt="image-20221103104121306" style="zoom:33%;" />

#### 几何距离检测

##### 直线上的某一点距离平面的最近的一点

<img src="/image-20221103104450299.png" alt="image-20221103104450299" style="zoom:33%;" />

##### 某一点在射线上最近的点

<img src="/image-20221103104625579.png" alt="image-20221103104625579" style="zoom:33%;" />

##### 点到平面的距离

<img src="/image-20221103104651714.png" alt="image-20221103104651714" style="zoom:50%;" />

##### 点到平面上最近的点

<img src="/image-20221103104738284.png" alt="image-20221103104738284" style="zoom:33%;" />

##### 计算某点距离AABB最近的一个顶点是那个



#### 几何相交检测

##### 2d直线相交

<img src="/image-20221103105420844.png" alt="image-20221103105420844" style="zoom:33%;" />

##### 3d两条射线相交

<img src="/image-20221103105456619.png" alt="image-20221103105456619" style="zoom:50%;" />

##### 3d射线与平面的相交性检测

<img src="/image-20221103105604183.png" alt="image-20221103105604183" style="zoom:50%;" />

##### 射线与球的相交性

<img src="/image-20221103105720014.png" alt="image-20221103105720014" style="zoom:33%;" />

##### 两个圆/球的相交性检测

<img src="/image-20221103105922086.png" alt="image-20221103105922086" style="zoom:33%;" />

##### 球和平面的相交性检测

<img src="/image-20221103110103775.png" alt="image-20221103110103775" style="zoom:33%;" />

#### 复杂的相交性检测

##### 射线与AABB的相交性检测

##### 射线和三角形相交

##### 两个AABB的相交性检测

###### 两个静态的相交性检测

###### 两个动态的相交性检测

##### 应用

场景 开枪打鸟， 先判断射线是否与AABB相交，然后判断 射线与鸟的三角面是否相交判断 打中了那个部位

#### 网格

物体由一个个三角形网格组成

Mesh 类的封装

##### 三角网格平面法向量和顶点法向量

##### 三角网格操作

+ 逐片操作
+ 焊接顶点
+ 面拆分
+ 边缩坍和顶点拆分
+ 网格消减



#### 图形流水线

<img src="/image-20221103140905573.png" alt="image-20221103140905573" style="zoom:33%;" />

<img src="/image-20221103141219348.png" alt="image-20221103141219348" style="zoom:33%;" />

<img src="/image-20221103141335334.png" alt="image-20221103141335334" style="zoom:33%;" />



#### 设置视图参数

<img src="/image-20221103141445757.png" alt="image-20221103141445757" style="zoom:33%;" />

+ 指定窗口大小
+ 像素纵横比， 宽高比例
+ 视锥。  视野的大小



#### 坐标空间

+ 模型空间 物体坐标系
+ 世界空间
+ 摄像机空间
+ 裁剪空间。 相机可视范围内的空间
+ 屏幕空间。 2d显示空间



#### 光照和光源

+ 镜面光
+ 漫射光
+ 环境光

##### 光源

+ 点光源
+ 聚光灯
+ 平行光
+ 环境光



#### 雾化

+ 雾化浓度
+ 雾化距离

#### 纹理映射

<img src="/image-20221103144024283.png" alt="image-20221103144024283" style="zoom:50%;" />

![image-20221103144413168](/image-20221103144413168.png)

在平面中指定 映射纹理 的那个 坐标位置



#### 双缓存

应用： 使用双缓存消除闪烁

<img src="/image-20221103144805542.png" alt="image-20221103144805542" style="zoom:50%;" />

使用 缓冲区， 在缓冲区中 渲染， 但是缓冲区中是不显示的， 我们在缓冲区中进行擦除 绘制 完成后 ， 再复制到 屏幕上 

这就是缓冲区的作用



